- job:
    name: checkbox.io
    project-type: pipeline
    dsl: |
      node {
          stage('Source') {
              cleanWs()
              git 'https://github.com/chrisparnin/checkbox.io'
          }
          stage('Build') {
              sh 'npm install --prefix ./server-side/site'
              sh 'pm2 start ./server-side/site/server.js --name checkboxio'
          }
          stage('Static Analysis') {
              sh "find ./server-side/ -path ./server-side/site/node_modules -prune -false -o -name \"*.js\" -exec node /bakerx/lib/analysis.js {} \\;"
          }
          stage('Test') {
              sh 'cd ./server-side/site/ ; npm test'
          }
      }
