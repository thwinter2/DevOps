- job:
    name: iTrust
    project-type: pipeline
    dsl: |
      node {
          stage('Source') {
              git url: 'https://github.ncsu.edu/engr-csc326-staff/iTrust2-v8', credentialsId: 'gh-password', branch: 'main'
          }
          try{
            stage('Build') {          
                sh 'cp /bakerx/application.yml iTrust2/src/main/resources/application.yml'
                sh 'cd iTrust2; mvn clean test integration-test checkstyle:checkstyle'
            }
          } catch (e){
            throw e
          }
          finally{
            sh '''
              set +x
              mysql -u root -p$MYSQL_PASSWORD -e 'DROP DATABASE IF EXISTS iTrust2_test' 2>/dev/null
              pkill chrome || true
              fuser -k 9001/tcp || true
            '''
            cleanWs()
          }
      }

